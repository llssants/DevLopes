<!-- templates/projetos.html -->
{% extends 'dashboard.html' %}

{% block title %}Projetos - DevLopes{% endblock %}

{% block content %}
<h1>Projetos</h1>
<div class="row">
  {% for projeto in projetos %}
    <div class="col-md-4 mb-4">
      <div class="card card-hover" data-toggle="collapse" data-target="#detalhes-{{ projeto.id }}" aria-expanded="false" aria-controls="detalhes-{{ projeto.id }}">
        <div class="card-body">
          <h5 class="card-title">{{ projeto.titulo }}</h5>
          <p class="card-text text-truncate">{{ projeto.descricao }}</p>
          <span class="badge badge-info">{{ projeto.get_status_display }}</span>
        </div>
      </div>
      <div class="collapse mt-2" id="detalhes-{{ projeto.id }}">
        <div class="card card-body">
          <h6>Detalhes do Projeto</h6>
          <p><strong>Descrição:</strong> {{ projeto.descricao }}</p>
          <p><strong>Status:</strong> {{ projeto.get_status_display }}</p>
          <p><strong>Alunos:</strong>
            {% for aluno in projeto.alunos.all %}
              {{ aluno.nome }}{% if not forloop.last %}, {% endif %}
            {% empty %}
              Nenhum aluno
            {% endfor %}
          </p>
          <p><strong>Clientes:</strong>
            {% for cliente in projeto.clientes.all %}
              {{ cliente.nome }}{% if not forloop.last %}, {% endif %}
            {% empty %}
              Nenhum cliente
            {% endfor %}
          </p>
          <button class="btn btn-primary btn-sm" data-toggle="modal" data-target="#chatModal-{{ projeto.id }}">Conversar</button>
        </div>
      </div>
    </div>

    <!-- Modal de Chat -->
    <div class="modal fade" id="chatModal-{{ projeto.id }}" tabindex="-1" aria-labelledby="chatModalLabel-{{ projeto.id }}" aria-hidden="true">
      <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="chatModalLabel-{{ projeto.id }}">Chat - {{ projeto.titulo }}</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <!-- Aqui entra o chat, pode ser estático ou dinâmico com JS ou websocket -->
            <div id="chat-messages-{{ projeto.id }}" style="height:300px; overflow-y:auto; border:1px solid #ddd; padding:10px; background:#f9f9f9;">
              <p><em>Chat ainda não implementado.</em></p>
            </div>
            <form id="chat-form-{{ projeto.id }}">
              <div class="input-group mt-3">
                <input type="text" class="form-control" placeholder="Digite sua mensagem..." aria-label="Mensagem" required>
                <div class="input-group-append">
                  <button class="btn btn-success" type="submit">Enviar</button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  {% endfor %}
</div>
{% endblock %}
